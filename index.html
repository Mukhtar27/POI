<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global POI Finder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.2em;
            color: #374151;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-field, .input-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .input-field:focus, .input-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .generate-btn, .download-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .generate-btn:hover, .download-btn:hover {
            background: #059669;
        }

        #resultsSection {
            margin-top: 20px;
            display: none;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .results-table th, .results-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .results-table th {
            background: #f8fafc;
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .toggle-visibility {
            cursor: pointer;
            position: absolute;
            right: 10px;
            top: 36px;
            background: none;
            border: none;
            font-size: 18px;
            color: #6b7280;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Global POI Finder</h1>
            <p>Find points of interest around a given location.</p>
        </div>
        <div class="input-group">
            <label class="input-label">üìç Enter Latitude</label>
            <input type="number" id="latitude" class="input-field" step="0.000001" placeholder="e.g. 40.712776">
        </div>
        <div class="input-group">
            <label class="input-label">üìç Enter Longitude</label>
            <input type="number" id="longitude" class="input-field" step="0.000001" placeholder="e.g. -74.005974">
        </div>
        <div class="input-group">
            <label class="input-label">üìè Radius (meters)</label>
            <input type="number" id="radius" class="input-field" value="10000" min="10" max="50000">
        </div>
        <div class="input-group">
            <label class="input-label">üîë Google Maps API Key</label>
            <div style="position: relative;">
                <input type="password" id="apiKey" class="input-field" placeholder="Enter your API key">
                <button class="toggle-visibility" onclick="toggleApiKeyVisibility()">üëÅÔ∏è</button>
            </div>
        </div>
        <div class="input-group">
            <label class="input-label">üè∑Ô∏è Business Category</label>
            <select id="category" class="input-select">
                <option value="accounting">Accounting</option>
                <option value="airport">Airport</option>
                <option value="amusement_park">Amusement Park</option>
                <option value="aquarium">Aquarium</option>
                <option value="art_gallery">Art Gallery</option>
                <option value="atm">ATM</option>
                <option value="bakery">Bakery</option>
                <option value="bank">Bank</option>
                <option value="bar">Bar</option>
                <option value="beauty_salon">Beauty Salon</option>
                <option value="bicycle_store">Bicycle Store</option>
                <option value="book_store">Book Store</option>
                <option value="bowling_alley">Bowling Alley</option>
                <option value="bus_station">Bus Station</option>
                <option value="cafe">Cafe</option>
                <option value="campground">Campground</option>
                <option value="car_dealer">Car Dealer</option>
                <option value="car_rental">Car Rental</option>
                <option value="car_repair">Car Repair</option>
                <option value="car_wash">Car Wash</option>
                <option value="casino">Casino</option>
                <option value="cemetery">Cemetery</option>
                <option value="church">Church</option>
                <option value="city_hall">City Hall</option>
                <option value="clothing_store">Clothing Store</option>
                <option value="convenience_store">Convenience Store</option>
                <option value="courthouse">Courthouse</option>
                <option value="dentist">Dentist</option>
                <option value="department_store">Department Store</option>
                <option value="doctor">Doctor</option>
                <option value="drugstore">Drugstore</option>
                <option value="electrician">Electrician</option>
                <option value="electronics_store">Electronics Store</option>
                <option value="embassy">Embassy</option>
                <option value="fire_station">Fire Station</option>
                <option value="florist">Florist</option>
                <option value="funeral_home">Funeral Home</option>
                <option value="furniture_store">Furniture Store</option>
                <option value="gas_station">Gas Station</option>
                <option value="gym">Gym</option>
                <option value="hair_care">Hair Care</option>
                <option value="hardware_store">Hardware Store</option>
                <option value="hindu_temple">Hindu Temple</option>
                <option value="home_goods_store">Home Goods Store</option>
                <option value="hospital">Hospital</option>
                <option value="insurance_agency">Insurance Agency</option>
                <option value="jewelry_store">Jewelry Store</option>
                <option value="laundry">Laundry</option>
                <option value="lawyer">Lawyer</option>
                <option value="library">Library</option>
                <option value="light_rail_station">Light Rail Station</option>
                <option value="liquor_store">Liquor Store</option>
                <option value="local_government_office">Local Government Office</option>
                <option value="locksmith">Locksmith</option>
                <option value="lodging">Lodging</option>
                <option value="meal_delivery">Meal Delivery</option>
                <option value="meal_takeaway">Meal Takeaway</option>
                <option value="mosque">Mosque</option>
                <option value="movie_rental">Movie Rental</option>
                <option value="movie_theater">Movie Theater</option>
                <option value="moving_company">Moving Company</option>
                <option value="museum">Museum</option>
                <option value="night_club">Night Club</option>
                <option value="painter">Painter</option>
                <option value="park">Park</option>
                <option value="parking">Parking</option>
                <option value="pet_store">Pet Store</option>
                <option value="pharmacy">Pharmacy</option>
                <option value="physiotherapist">Physiotherapist</option>
                <option value="plumber">Plumber</option>
                <option value="police">Police</option>
                <option value="post_office">Post Office</option>
                <option value="primary_school">Primary School</option>
                <option value="real_estate_agency">Real Estate Agency</option>
                <option value="restaurant">Restaurant</option>
                <option value="roofing_contractor">Roofing Contractor</option>
                <option value="rv_park">RV Park</option>
                <option value="school">School</option>
                <option value="secondary_school">Secondary School</option>
                <option value="shoe_store">Shoe Store</option>
                <option value="shopping_mall">Shopping Mall</option>
                <option value="spa">Spa</option>
                <option value="stadium">Stadium</option>
                <option value="storage">Storage</option>
                <option value="store">Store</option>
                <option value="subway_station">Subway Station</option>
                <option value="supermarket">Supermarket</option>
                <option value="synagogue">Synagogue</option>
                <option value="taxi_stand">Taxi Stand</option>
                <option value="tourist_attraction">Tourist Attraction</option>
                <option value="train_station">Train Station</option>
                <option value="transit_station">Transit Station</option>
                <option value="travel_agency">Travel Agency</option>
                <option value="university">University</option>
                <option value="veterinary_care">Veterinary Care</option>
                <option value="zoo">Zoo</option>
            </select>
        </div>
        <button class="generate-btn" id="fetchBtn" onclick="fetchPOIs()">Get POIs</button>
        <button class="download-btn" id="downloadBtn" style="display:none;" onclick="downloadResults()">Download Results</button>
        
        <div id="errorMessage" class="error-message"></div>
        
        <div id="resultsSection">
            <h3>Results</h3>
            <table class="results-table" id="resultsTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Distance (m)</th>
                    </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let results = [];

        function toggleApiKeyVisibility() {
            const input = document.getElementById('apiKey');
            const button = document.querySelector('.toggle-visibility');

            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà'; // Change the icon to indicate hide
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è'; // Change the icon to indicate show
            }
        }

        async function fetchPOIs() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            const radius = parseInt(document.getElementById('radius').value);
            const apiKey = document.getElementById('apiKey').value.trim();
            const category = document.getElementById('category').value.trim();
            
            // Validation
            if (!apiKey) {
                showError('Please enter a valid API Key.');
                return;
            }
            if (isNaN(lat) || isNaN(lng)) {
                showError('Please enter valid latitude and longitude values.');
                return;
            }

            hideError();
            document.getElementById('resultsSection').style.display = 'none';
            const resultsBody = document.getElementById('resultsBody');
            resultsBody.innerHTML = '';
            results = []; // Reset results

            const types = [category]; // Using the selected category

            for (let placeType of types) {
                let url = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${lat},${lng}&radius=${radius}&type=${placeType}&key=${apiKey}`;
                const unique_ids = new Set();

                while (true) {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.status === 'OK') {
                        data.results.forEach(place => {
                            const place_id = place.place_id;
                            if (!unique_ids.has(place_id)) {
                                unique_ids.add(place_id);
                                results.push({
                                    name: place.name || 'Unnamed Place',
                                    address: place.vicinity || 'No Address Available',
                                    distance: place.geometry.location ? 
                                        calculateDistance(lat, lng, place.geometry.location.lat(), place.geometry.location.lng()).toFixed(2) : 'N/A'
                                });
                                const row = resultsBody.insertRow();
                                row.insertCell(0).innerText = results[results.length - 1].name;
                                row.insertCell(1).innerText = results[results.length - 1].address;
                                row.insertCell(2).innerText = results[results.length - 1].distance;
                            }
                        });

                        // Check for the next page
                        if (data.next_page_token) {
                            await new Promise(resolve => setTimeout(resolve, 2000)); // Wait before requesting the next page
                            url = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${lat},${lng}&radius=${radius}&type=${placeType}&key=${apiKey}&pagetoken=${data.next_page_token}`;
                        } else {
                            break; // No more pages
                        }
                    } else {
                        showError('No results found or invalid API key.');
                        break;
                    }
                }
            }

            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('downloadBtn').style.display = results.length > 0 ? 'block' : 'none'; // Show download button if there are results
        }

        function downloadResults() {
            if (results.length === 0) return;
            
            const worksheet = XLSX.utils.json_to_sheet(results);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'POI Results');
            XLSX.writeFile(workbook, 'poi_results.xlsx');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerText = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.display = 'none';
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // metres
            const œÜ1 = lat1 * Math.PI/180; // œÜ in radians
            const œÜ2 = lat2 * Math.PI/180; // œÜ in radians
            const ŒîœÜ = (lat2-lat1) * Math.PI/180;
            const ŒîŒª = (lon2-lon1) * Math.PI/180;

            const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                      Math.cos(œÜ1) * Math.cos(œÜ2) *
                      Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c; // in metres
        }
    </script>
</body>
</html>
